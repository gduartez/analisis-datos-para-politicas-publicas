---
bibliography: references.bib
---

```{r}
#| echo: false

library(webexercises)
```

# Operaciones Básicas {#sec-data-basics .unnumbered}

## Introducción

`R` debe entenderse como un lenguaje y ambiente de programación. A lo largo de este apartado, enfocaremos el uso del software como un proceso de **exploración de datos**:

![Fuente: [@wickham2023]](images/1.%20Exploración%20de%20Datos.png){fig-align="center"}

## Rstudio

Una vez descargado `R` y `Rstudio`, para empezar a trabajar basta con abrir la aplicación ![](images/rstudio.png){width="50"}. La ventaja de esta plataforma es que entrega una interfaz más amigable para el trabajo, la cual se divide en 4 partes:

1.  **Scripts o Editor de Código (Parte Superior Izquierda):** Aquí es donde escribes y guardas tu código. Piensa en esto como un cuaderno digital donde puedes escribir varias líneas de código antes de ejecutarlas. A diferencia de la consola, el código aquí **no** se ejecuta de inmediato. Para hacerlo, primero debes seleccionarlo y presionar **Ctrl + Enter** (Windows/Linux) o **Cmd + Enter** (Mac) para ejecutarlo línea por línea o en bloques.

2.  **Consola (Parte Inferior Izquierda):** Aquí puedes escribir código y ejecutarlo directamente, obteniendo resultados de inmediato. Sin embargo, lo que escribas en la consola no se guarda automáticamente, por lo que es **mejor usar scripts** para guardar tu trabajo y reutilizarlo en el futuro. Al ejecutar un script o una parte de él, código se correra directamente en la consola.

3.  **Environment (Parte Superior Derecha):** Muestra los **objetos** que has creado en tu sesión, como variables, data frames y funciones. Piénsalo como una lista de los elementos con los que estás trabajando.

4.  **Files y Otros Paneles (Parte Inferior Derecha):** una caja de herramientas con varias funciones útiles: [les:]{.underline} Permite navegar por los distintos archivos del computador

    i)  [Files:]{.underline} Permite navegar por entre carpetas y archivos de tu computador o la nube

    ii) [Plots:]{.underline} Muestra los gráficos que generas con R.

    iii) [Packages:]{.underline} Aquí podemos instalar y cargar las distintas librerías con las que trabajaremos.

    iv) [Help:]{.underline} Pestaña de ayuda para buscar sintaxis y argumentos de las funciones que usemos.

    v)  [Viewer:]{.underline} Se usa para visualizar reportes en HTML, tablas y mapas interactivos y otros elementos gráficos.

![Panel Layout Rstudio](images/panel-layout.png)

## Primeros Pasos

1.  Abrir ![](images/rstudio.png){width="50"}
2.  Abrir un script usando `CTRL + SHIFT + N` o bien usando el menú de Rstudio ![](images/r_script.png){width="100"}. Esto debiese abrir una ventana como la que se ve a continuación:

![](images/script.png)

## Operaciones Básicas {#sec-op-basicas}

El signo `#` permite escribir texto en el script, el cual no será considerado cómo código al momento de ejecutar un comando:

```{r}
# Así puedo comentar líneas de comando
```

`R` se puede ocupar como calculadora para las principales operaciones matemáticas y operadores lógicos. Por ejemplo, al escribir en la consola 2+2 y apretar `ENTER` (o `CTRL + ENTER` si escribo el código en el **script**) nos devolverá el resultado de 4:

```{webr-r}
2+2
```

Es importante considerar la siguiente información respecto de las operaciones al escribir código en `R`:

-   Si una línea termina con una operación, pasará a la siguiente línea para continuar.
-   Los espacios dentro de una misma línea no se consideran relevantes.
-   El operador lógico de "igual" se escribe: `==`.

Las **operaciones matemáticas** más utilizadas se señalan en la siguiente tabla:

| Operador       | Sintaxis                       |
|----------------|--------------------------------|
| Suma           | \+                             |
| Resta          | \-                             |
| División       | /                              |
| Multiplicación | \*                             |
| \^             | Exponente                      |
| %%             | Módulo (Resto de una división) |
| %/%            | División Entera                |

: Operaciones Matemáticas

Mientras que los **operadores lógicos** más usados, estan en la siguiente tabla:

| Operador              | Sintaxis |
|-----------------------|----------|
| Mayor                 | \>       |
| Menor                 | \<       |
| Igual                 | ==       |
| Distinto              | !=       |
| Mayor o igual         | \>=      |
| Menor o igual         | \<=      |
| En (Contiene a)       | %in%     |
| No en (No contiene a) | !(%in%)  |

: Operadores Lógicos

::: callout-note
### Nota
Los operadores lógicos nos serán de mucha ayuda cuando trabajemos con la manipulación de datos, lo cual se verá en el apartado de Herramientas para la Ciencia de Datos. En particular, el operador `%in%` nos permitirá eficientar nuestro código cuando queramos hacer filtros o selecciones múltiples.
:::

### Ejemplos

```{webr-r}
#Operaciones matemáticas básicas

1 + 2 + 3

# Si dejo espacio en blanco en una línea, este NO afectará el resultado
1 +2 *      3

# Recordar que los decimales se escriben con un "." y no con ","
4.4 / 2.2

3 ^ 2

(1+2)* #si una linea termina con una operacion, "pasará" a la siguiente línea para continuar
  3

#Operadores lógicos

2 > 3
3 > 3
3 >= 3
3 == 3
2 != 3

```

## Operaciones con Vectores

En general, se suele trabajar con estructuras de datos. La estructura más básica es el vector. Con la función `c()` (que se conoce como combinar) se pueden crear vectores.

Se pueden realizar operaciones matemáticas con vectores al igual que como se realizan con números.

`R` entrega mensajes de error y advertencia. Ejemplo de esto último ocurre cuando se realizan operaciones con vectores de distintas dimensiones, en donde el vector más corto se vuelve a operacionalizar con las componentes restantes del vector más largo en orden lógico (izquierda a derecha).

```{r, warning=TRUE}
c(1,2,3) + c(2,3,4)
```

```{r, warning=TRUE, echo=TRUE}
c(1,2,3,4) + c(2,3,4)
```

En efecto, vemos que en el segundo caso lo que hace R es el siguiente proceso: $$Z = X + Y =\{x_1+y_1,x_2+y_2,x_3+y_3,x_4+y_1\}$$ donde $X$ es un vector tal que $X=\{x_1=1,x_2=2,x_3=3,x_4=4\}$ e $Y$ es otro vector tal que $Y=\{y_1=2,y_2=3,y_3=4\}$

También se puede trabajar con datos de carácter. La forma de indicar que un dato es *string* (carácter) es escribiendo el texto entrecomillas: `""`

```{r}
"Esto es un caracter"
```

La función `class()` permite conocer qué tipo de dato es el objeto indicado, es decir, conocer su clase

```{r}
class(c(1,2,3))
```

```{r}
class("Esto es un caracter")
```

Con la función `c()` se pueden crear vectores de datos de carácter, al igual que cómo se realiza con números. También se pueden crear vectores con los valores lógicos: `TRUE`, `FALSE` y `NA`.

```{r}
c('Hola','Adios')
class(c('Hola','Adios'))
```

```{r}
c(TRUE,FALSE,NA)
class(c(TRUE,FALSE,NA))
```

Es importante señalar que los vectores solo admiten un tipo de dato, es decir, no se puede combinar en un solo vector datos numéricos y lógicos, por ejemplo. Si se combinan, R hará la transformación correspondiente a un solo tipo de dato.

```{r, warning=TRUE}
c(2,TRUE)
class(c(2,TRUE))
```

```{r, warning=TRUE}
c(1,'Hola',FALSE)
class(c(1,'Hola',FALSE))
```

## Creación de Variables

La creación de variables u *objetos* se operacionaliza con el siguiente símbolo: `<-` o bien `ALT + -`

Por ejemplo, asignar a x el valor 1 se escribe así: `x <- 1`. La forma rápida de escribir el símbolo de creación es a través de: *ALT + -*:

```{r}
x <- 1
y <- 2
```

Para ver más atajos, se puede buscar en herramientas -\> *Keyboard shortcuts quick reference*.

![](images/shortcuts.png)

Las variables creadas se muestran en *Global environment*. También se pueden sobrescribir las variables si se ejecuta un código posterior a la primera creación de la variable.

Con la función `c()` se pueden generar vectores combinados en función de las variables creadas. La creación de variables también puede incluir operaciones de variables ya creadas (por ejemplo, `sumadexey <- x+y`):

```{r}
sumadexey <- x+y
sumadexey
```

::: callout-important
### Importante

Al reescribir una variable, por ejemplo, x, se alterará el valor de la variable x, mas no el valor de la variable creada anteriormente `sumadexey`. Es decir, cambiar el valor de x **no influye en los objetos ya creados**. Técnicamente, esta característica se le conoce como que la asignación de valores **no es reactiva**.

Lo anterior implica que, a medida que vamos realizando cambios en un mismo objeto, si queremos corregir algo en un paso intermedio, debemos asegurarnos de correr todo el código **desde el inicio** (o al menos en las partes relevantes) con el fin de minimizar los riesgos de cometer un error en nuestros cálculos.
:::

```{r}
sumadexey <- x+y
x <- 3
x+y
sumadexey
```

### Eliminación de Variables

Se pueden eliminar variables con la función `rm()`que significa *remove*

```{r}
rm(x)
```

Si se quiere eliminar todo lo que está en *Global environment* se puede ocupar la siguiente función: `rm(list=ls())`

```{r}
x <- 3
z <- 5
rm(list=ls())
```

## Trabajo con Objetos

En la siguiente sección se estudia cómo aprovechar la facilidad de trabajar con objetos en R.

Para crear un vector ocupamos el comando de creación:

```{r}
vector1 <- c(0,2,4,6,8,10,12,12,14,16,18,20)
```

Para devolver el valor en la posición 5 del vector, realizamos la siguiente operación:

```{r}
vector1[5]
```

Es clave entender la funcionalidad del *corchete* `[]` aplicándolo a una variable x cualquiera:

| Sintaxis | Valor que Entrega |
|------------------------------------|------------------------------------|
| \[n positivo\] | Valor de la componente del vector en la posición n |
| \[n negativo\] | Valor de todas las componentes del vector excepto la posición n |
| \[n:m\] | Valor de las componentes del vector desde la posición n hasta la m inclusive |
| == n | Operador lógico para cada componente del vector que indica si se cumple la condición (=n) |
| \[x==n\] | Extrae todos los valores del vector que cumplen la condición (valores igual a n) |
| \[x!=n\] | Extrae todos los valores del vector que cumplen la condición (valores distintos a n) |

: Funcionalidad del \[\]

```{r}

vector1[-1] #extraer todos los números de vector1 menos el que está en la posición 1

vector1[2:4] #extraer los números entre la posición 2 y 4 (incluyéndolos) de vector1

vector1[c(1,3,5)] #extraer los números en las posiciones 1, 3 y 5 de vector1

vector1 == 12 #vector con operadores lógicos para condición

vector1[vector1==12] #extraer todos los números de vector1 iguales a 12

vector1[vector1!=12] #extraer todos los números de vector1 distintos a 12
```

## Ejercicios Aplicados a Política Pública

En esta sección trabajaremos con datos de Chile que nos permitan realizar algunas de las operaciones básicas revisadas. Estos datos son sobre:

1.  Población comunal
2.  Datos de empleo
3.  Datos delictuales

::: callout-important
### Importante

Para responder preguntas que incluyan decimales, es necesario usar el `.` como separador en lugar de la `,` ya que R sigue la convención anglosajona de puntuación.
:::

### Población Según División Administrativa de Chile

La división territorial de Chile contempla las siguientes unidades geográficas:

- El país completo se divide en **16 regiones**.
- Cada región se subdivide a la vez en **provincias**, las cuales suman **56** a nivel nacional.
- De manera análoga, cada provincia contempla un número definido de **comunas**, las cuales suman **346** en total.

Considere el caso de la XV Región de Arica y Parinacota, la cual está compuesta por las provincias de Arica y Parinacota. La provincia de Arica, contiene a las comunas de Arica y Camarones, mientras que la provincia de Parinacota, a las comunas de General Lagos y Putre. Según proyecciones del censo 2017, la población en el año 2025 de cada comuna es la siguiente:

| Comuna        | Población Año 2025 |
|---------------|--------------------|
| Arica         |     259.064        |
| Camarones     |     1.248          |
| General Lagos |     797            |
| Putre         |     2.578          |

: Población Comunal año 2025 Región de Arica y Parinacota según proyecciones Censo 2017.

Utilizando los datos de población entregada, responda las siguientes preguntas:

::: {.callout-quiz .callout}
#### Población XV° Región

1.  ¿Cuánta es la población de la **Provincia de Arica**?  `r fitb(259064+1248)`

2. ¿Cuánta es la población de la **Provincia de Parinacota**? `r fitb(797+2578)`

3.  ¿Cuánta es la población de la **Región de Arica y Parinacota**? `r fitb(259064+1248+797+2578)`

4.  ¿Qué porcentaje representa la población de la comuna de Arica respecto a la población regional? (aproxime a dos decimales) `r fitb(round(259064/(259064+1248+797+2578)*100,2))`

:::

### Registros Delictuales

En Chile, existen diversas fuentes que reportan la cantidad de delitos ocurridos. Una de las más importantes, es la que sitematiza la Subsecreataría de Prevención del Delito a partir de los **casos policiales**.

Este último indicador, es una de las variables principales para analizar la ocurrencia de hechos delictivos. Considera las **denuncias** de delitos que realiza la comunidad en las unidades policiales, más las **detenciones** que realizan las policías ante la ocurrencia de delitos flagrantes. Internacionalmente, este indicador es conocido como “delitos conocidos por la policía” (*crimes known to police*).

Generalmente, al analizar la evolución del fenómeno en el tiempo, se suelen usar dos formas de medición:

1.  **Frecuencia Simple:** Presenta la cantidad de ilícitos registrados en una unidad territorial determinada.

2.  **Tasa Cada 100.000 Habitantes:** Es un indicador que relaciona el total de ilícitos –registrados por las policías a través de una denuncia o una detención flagrante– de un territorio con su población. Su importancia metodológica es que permite **comparar distintos niveles territoriales** (comuna, región y país), en **distintos períodos de tiempo** (meses, trimestres y años). Se calcula dividiendo el total de delitos registrados por las policías en un periodo de tiempo (meses, trimestres o años) por la población de referencia para ese mismo periodo, el resultado es multiplicado por 100 mil. De esta forma, la tasa delictual cada 100.000 habitantes queda definida como $$Tasa_{itj} = \frac{Frecuencia_{it}}{Población_{jt}}\times 100.000$$

donde $i$ representa el delito analizado y $j$ el territorio analizado y $t$ el periodo de tiempo analizado.

3.  **Variación Porcentual:** Indica si la variable en estudio aumentó o disminuyó. Si la variación resulta positiva significa que la variable aumentó en valor, si la variación resulta negativa significa que la variable disminuyó en valor. Matemáticamente, un variación porcentual se calcula como: $$\Delta\% = \frac{valor_{t1} - valor_{t0}}{valor_{t0}}\times 100 = [\frac{valor_{t1}}{valor_{t0}}-1]\times 100$$

donde $t0$ corresponde al periodo inicial y $t1$ al periodo final (por ejemplo, año de inicio de la comparación o $t0$ y año de término de la comparación o $t1$).

Considerando lo anterior, responda las siguientes preguntas aproximando el valor entregado **a un solo decimal**.

::: {.callout-quiz .callout}
#### Homicidios en Chile
1.  Según datos del observatorio de homicidios, en el año 2023 hubo 1.248 víctimas consumadas de homicidios. Si la población nacional proyectada para el año 2023 era de 19.960.889 habitantes ¿Cuál fue la tasa de víctimas de homicidios consumados cada 100.000 habitantes en el año 2023? `r fitb(round(1248/19960889*100000,1))`

2.  En el año 2022 se registraron 1.330 víctimas de homicidios consumados y hubo una proyección de población de 19.828.563 ¿Cuánto fue la variación porcentual de la **cantidad** de víctimas consumadas de homicidios entre 2022 y 2023?  `r fitb(round((1248/1330-1)*100,1))`

3.  Asumamos que la población en Chile permanece constante entre el año 2022 y el año 2023. En ese contexto, un colega suyo le dice que es mejor calcular la variación porcentual en términos de tasa que en términos de frecuencia ¿Qué le respondería usted?

4.  En el año 2021, en El Salvador se registraron 1.085 víctimas de homicidios intencionales, mientras que en el año siguiente en Chile se registraron 1.330 víctimas de homicidio. A partir de esto, un colega le señala que *Chile está experimentando un nivel de violencia más alto de lo que era El Salvador en el año 2021 y en periodos anteriores* ¿Que le respondería usted a su colega?
:::

## Bibliografía

<!-- ```{r} -->

<!-- tasa22 <- 1330/19828563*100000 -->

<!-- tasa23 <- 1248/19960889*100000 -->

<!-- tasa22_23 <- 1330/19960889*100000 -->

<!-- #Variación -->

<!-- (tasa23/tasa22_23-1)*100 -->

<!-- (tasa23/tasa22-1)*100 -->

<!-- (1248/1330-1)*100 -->

<!-- ``` -->
